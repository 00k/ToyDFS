language: cpp
compiler: gcc
env:
    global:
        - secure: "Y4lDq9rLykf3H2I5SKJXv59JRGap0iu6FReCYt8deSrlLOB1v7haEYeVRnbQHP6MWY4ZgFq8Z02YjUqbFiogKudrvdik2VNrvgVH79ZIy+5tfKJuQotLbeIWHHxZslLGtCCradm5LKBPCK8qso5U3LhcRxGtps/aEF3uWYPws8Nvb4qzygVrjKCRpT+uWmmr0X+y+d54R3yhmZpY6U0TibeWwMXUAKEaZEr8WyVgJJOOacOuiDNUYl3Ok9o/jf4xDdlotLzIUFV/2W0HyOczuoCzlNORrujVqoZ1kpgxEJkFkLC1pQHsj6jGIYKqKFw//GYh9ybYDDmP2iHY2WZJmTpBfg7EFM0RnlEge6FjhBmfnD83d3P638HNEz8v9pEiHCF47tQuIMxiaf2bJmrUslcQ0Ay4ead+0B+seYqFcJZqm3myMH/LKiRW6p0F7cZmrN1LT+0yclEksqABaxWY2/0ky91NiOkPWlZlNqEgXShUFMZ2UErCYWJO9gCEwdU83B65n4zYPMCHEZcIxObsJNIakYLRop6JUBA7a9VU3xR1loGVuIlGNejFpENA/fYVm3gM6/8rXpZyV378l6UmYWG/iXChqKY8stTJuD9Dgx4aez3w82Xqz9LDJJYyXB9HeMntyY71+CQS2fNVbwubobKN06uK7llc7i8xl2udezA="
    matrix:
        - PROTOBUF_VERSION=2.6.0

install:
    - echo | sudo apt-add-repository ppa:boost-latest/ppa
    - sudo apt-get update
    - sudo apt-get install libboost-dev
    - wget https://github.com/google/protobuf/releases/download/v$PROTOBUF_VERSION/protobuf-$PROTOBUF_VERSION.tar.gz
    - tar xf protobuf-$PROTOBUF_VERSION.tar.gz
    - ( cd protobuf-$PROTOBUF_VERSION && ./configure && make -j4 && sudo make install)
    - git clone https://github.com/google/snappy
    - ( cd snappy && sh ./autogen.sh && ./configure && make -j2 && sudo make install && sudo ldconfig )
    - sudo apt-get install zlib1g-dev
    - git clone https://github.com/baidu/sofa-pbrpc ./thirdparty/sofa-pbrpc
    - ( cd thirdparty/sofa-pbrpc && make -j4 && make install);
    - wget https://github.com/gflags/gflags/archive/v2.1.2.tar.gz
    - tar xf v2.1.2.tar.gz
    - ( cd gflags-2.1.2 && cmake -DGFLAGS_NAMESPACE=google && make -j4 && sudo make install )
    - git clone https://github.com/baidu/common
    - ( cd common && make -j4 && make install)
    - wget --no-check-certificate https://googletest.googlecode.com/files/gtest-1.7.0.zip
    - unzip gtest-1.7.0.zip
    - ( cd gtest-1.7.0 && ./configure --disable-shared --with-pic && make -j4 && sudo cp -a lib/.libs/* /usr/lib && sudo cp -a include/gtest /usr/include )

    - wget http://download.savannah.gnu.org/releases/libunwind/libunwind-0.99-beta.tar.gz
    - tar zxvf libunwind-0.99-beta.tar.gz
    - ( cd libunwind-0.99-beta && ./configure CFLAGS=-U_FORTIFY_SOURCE --with-pic && make -j4 && sudo make install )

    - wget https://googledrive.com/host/0B6NtGsLhIcf7MWxMMF9JdTN3UVk/gperftools-2.2.1.tar.gz
    - tar zxvf gperftools-2.2.1.tar.gz
    - ( cd gperftools-2.2.1 && ./configure --with-pic && make -j4 && sudo make install && sudo ldconfig )



before_script:
    - echo 'SNAPPY_PATH=./thirdparty/snappy' > depends.mk
    - echo 'PROTOBUF_PATH=./thirdparty/protobuf' >> depends.mk
    - echo 'PROTOC=protoc' >> depends.mk
    - echo 'PBRPC_PATH=./thirdparty/sofa-pbrpc/output' >> depends.mk
    - echo 'TCMALLOC_PATH=./thirdparty' >> depends.mk
    - echo 'COMMON_PATH=./common/output' >> depends.mk

script: make -j4 && make test

addons:
   coverity_scan:
       project:
           name: "myawan/bfs-1"
       notification_email: mayue01@baidu.com
       build_command_prepend: "make clean"
       build_command: "make -j4"
       branch_pattern: master

