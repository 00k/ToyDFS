#edit-mode: -*- python -*-
#coding:gbk

WORKROOT('../../../')

CopyUsingHardLink(True)

CPPFLAGS('-D_GNU_SOURCE -D__STDC_LIMIT_MACROS -DVERSION=\\\"1.0.0.0\\\"')

CXXFLAGS('-g -pipe -W -Wall -Werror -Wno-unused-parameter -fPIC')

INCPATHS('. ./src ./thirdparty/leveldb/include') # ./third_party/pbrpc/include')

LIBS('./thirdparty/leveldb/libleveldb.a') # ./third_party/pbrpc/libsofa_pbrpc.a')

LDFLAGS('-lpthread -lz')

CONFIGS('public/sofa-pbrpc@1.1.1.0')
CONFIGS('third-64/gflags@gflags_2-0-0-100_PD_BL')
CONFIGS('third-64/protobuf@2.6.1.200')
#CONFIGS('third-64/tcmalloc@tcmalloc_1-7-0-200_PD_BL')
#CONFIGS('third-64/snappy@1.0.5.100')

PROTOC('../../../third-64/protobuf/bin/protoc')

nameserver_sources='src/nameserver/nameserver_main.cc src/nameserver/nameserver_impl.cc \
                    src/nameserver/namespace.cc src/flags.cc src/common/logging.cc'
chunkserver_sources='''src/chunkserver/chunkserver_main.cc src/chunkserver/chunkserver_impl.cc src/chunkserver/file_cache.cc src/flags.cc
                    src/common/logging.cc src/common/cache.cc src/common/hash.cc'''
sdk_sources='src/sdk/bfs.cc src/flags.cc src/common/logging.cc src/common/tprinter.cc'
sdk_headers='src/sdk/bfs.h'
client_sources='src/client/bfs_client.cc'
proto_sources='src/proto/nameserver.proto src/proto/file.proto src/proto/chunkserver.proto'

#Application
Application('nameserver',Sources(nameserver_sources, proto_sources))
Application('chunkserver',Sources(chunkserver_sources, proto_sources))
Application('bfs_client',Sources(client_sources, sdk_sources, proto_sources))

#Libarary
StaticLibrary('bfs',Sources(sdk_sources, proto_sources),HeaderFiles(sdk_headers))

